<!doctype html>
<html lang=en>
<meta charset=utf-8>
<title>PICON - The Picon Icon Set - TAG </title>
<meta name=description content="Easy Hackable Ligature based PicoIcon Font">
<meta name=theme-color content=#F8F8F8>
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=manifest href=manifest.json>
<link rel=stylesheet href=style.css>
<link rel=icon type="image/x-icon" href=favicon.ico>
<link rel=apple-touch-icon href=apple-touch-icon.png>
<!--script src=list.js></script-->
<script src="opentype.js" defer></script>
<script src="build.js" defer></script>
<style>
body{margin: 0;}
.flex{display: flex;}
.wrap{flex-wrap: wrap;}
#icons>img{
	--size:32px;
	width:var(--size);
	padding: calc(var(--size)/8)
}
#icons>img:hover {
	cursor: pointer;
	box-shadow: 0 0 calc(var(--size)/8);
}
.sticky {position: sticky;}
.top {top: 0;}
</style>
<form id=List class=tile-l oninput=filter(this) onsubmit="return false">

<nav class="flex sticky top">
	<datalist id=names></datalist>
	<input type=search name=q list=names onfocus="names.childElementCount||datalist(names)" placeholder="Filter 🔍" aria-label=filter>
	<label><input type=checkbox onclick=highlightCheck(this.form,this.value)></label>
</nav>
		<blockquote hidden>
			<label>
				<output name=match></output> icon(s) found(s)
				
			</label>
		</blockquote>
<span hidden class=fab title="Build you selection" onclick="let font=makeFont(transform(serializeForm(List)), parsePb(METADATA.innerHTML));document.fonts.add(new FontFace(font.names.fontFamily.en, font.toArrayBuffer()));font.download()">
	<output name=check></output>
	<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M7,7 7,8 1,8 1,7 M3,4 3,1 5,1 5,4 7,4 4,7 1,4"></path></svg>
</span>

<div id=icons class="flex wrap"></div>
</form>

<script>
let picons = [];
const cache = file => localStorage[file] ? Promise.resolve(localStorage[file]) : fetch(file).then(r => r.text()).then(text => localStorage[file] = text);
const el = (tag, props={}, ch=[]) => ch.reduce((e,c) => (e.appendChild(c),e),Object.assign(document.createElement(tag),props))
const log = e => (console.log(e),e)
const show = ({glyphs,...font}) => glyphs.forEach(icon => window.icons.append(el('img', {
	alt: icon.tags,
	title: icon.ligatures,
	id: icon.ligatures,
	src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="' + icon.path.join(' ') + '"></path></svg>'
})));
//const dupsliga = (icons) => icons.map(i=>i.liga).reduce((acc,val,i,all) => all.indexOf(val) == all.lastIndexOf(val) ? acc : acc.concat(val), []);
const datalist = (icons,dl) => icons.forEach(icon => dl.append(el('option', {innerText:icon.name})));

cache('picon.json').then(JSON.parse).then(show);

navigator.serviceWorker && navigator.serviceWorker.register('sw.js');

/*
// DOM event related function
@form = <li id="latin-a.à"><img class=check src="data:..."></li><li>...
@return = [
	[["latin-a.à"],"<svg ..."],
	[["app"], "<svg ..."],
	...
]
function serializeForm(form) {
	return [...form.querySelectorAll('.check img')]
	.map(path => [path.closest('li').id, path.src])
}
function filter(form,className="highlight") {
	const all = form.querySelectorAll('li');
	all.forEach(li=>li.hidden=false);
	form.querySelector("blockquote").hidden=!form.q.value
	if(!form.q.value)return;
	const rule = `li:not([id*='${form.q.value}'])`;
	const matched = form.querySelectorAll(rule)
	matched.forEach(li=>li.hidden=true)
	form.match.value = all.length - matched.length;
}
function updateCheck(form){
	const nbChecked = form.querySelectorAll('.check').length
	form.check.value=nbChecked
	form.check.parentElement.hidden=!nbChecked
}
function highlightCheck(form, checked){
	const list = form.querySelectorAll('li:not([hidden])')
	list.forEach(li=>li.classList=checked?"check":'')
	updateCheck(form)
}
let prevToggle=null;
function toggle(li, event){
	const form = li.closest('form');
	const all = [...form.querySelectorAll('li')];
	if (!prevToggle)prevToggle = li;
	const [from, to] = [prevToggle,li].map(c=>all.findIndex(e=>c==e));
	var els = event.shiftKey?all.slice(...(from > to ? [to,from] : [from+1,to+1])):[li];
	els.map(cb=>cb.classList.toggle("check"))
	prevToggle = li;
	updateCheck(form)
}
function clip(a, event) {
	event.stopPropagation();
	const text = a.innerText;
	if (!navigator.clipboard)
		return alert(`No clipboard API to copy ${text}`);
	setTimeout(() => a.classList.remove('copied'),1000);
	navigator.clipboard.writeText(text).then(
		res => a.classList.add('copied'),
		err => alert(`Unable to copy ${text}\n`+err));
}
*/
</script>
