
<!doctype HTML>
<style>body{font-family: Helvetica, Arial, Sans-Serif;}</style>
<script src="https://cdn.jsdelivr.net/npm/opentype.js"></script>
<style>
.picon,rb {
font-family:picon;/*
line-height: 1;
font-style: normal;
font-weight: normal;
font-variant: normal;
text-transform: none;
word-break: break-all;*/
}</style>
<script>
window.addEventListener('DOMContentLoaded', (event) => {
	const template = document.querySelector('template');
	if(!template)return alert('please add a <template> (via CI)')
	const lines = template.innerHTML.split(/\n/);
	const svgs = lines.map(e=>e.split(/\s+/)).filter(_=>_.length>1);
	[showFont,showImg].forEach(f=>f(svgs));
});
function toSVG(g,size){
	return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}"><path d="${g.concat(' ')}"></path></svg>`
}
</script>
<nav>
	<a href=https://github.com/yne/svg>Github</a>
	<a href=editor.html>Editor</a>
</nav>


<h1>
SVG Image <rb>image</rb>
</h1>
<ruby>
<rbc><rb>ÊåØ</rb><rb>„Çä</rb><rb>‰ªÆ</rb><rb>Âêç</rb><rp>(</rp></rbc>
<rtc><rt>„Åµ</rt><rt>„Çä</rt><rt>„Åå</rt><rt>„Å™</rt><rp>)</rp></rtc>
</ruby>
<ruby>
ÊòéÊó• <rp>(</rp><rt>Ashita</rt><rp>)</rp>
</ruby>
Cols:<input name=--col value=32 style=width:3em type=number onchange=grid.style.setProperty(this.name,this.value)>
Size:<select name=--size data-unit=px onchange=grid.style.setProperty(this.name,this.value+this.dataset.unit)><option>8<option selected>16<option>24<option>32</select>
Gap:<input name=--gap data-unit=px value=8 style=width:3em type=number onchange=grid.style.setProperty(this.name,this.value+this.dataset.unit)>
<a download href=picon.tar.bz2>download all</a>
<div id=grid style="
--col:6;
--size:16px;
--gap:8px;
display: grid;
grid-template-columns: repeat(var(--col), var(--size));
grid-gap: var(--gap);
margin: var(--gap);
"></div>

<input>

<style>
ul {
	list-style: none;
}
ul>li{text-align:center}
ul>li:hover{box-shadow:0 2px 5px rgba(0,0,0,.2)}
ul>li>rb {font-size:32px;}
ul>li>pre{font-size:32px;}
</style>
<ul>
<li><rb>app</rb><pre>app</pre></li>
<li><rb>app</rb><pre>app</pre></li>
<li><rb>app</rb><pre>app</pre></li>
<li><rb>app</rb><pre>app</pre></li>
<li><rb>app</rb><pre>app</pre></li>
</ul>

<script>
const el=(tag,attr)=>Object.keys(attr).reduce((e,a)=>(e.setAttribute(a,attr[a]),e),document.createElement(tag));
function showImg(svgs) {
	//t.map(name=>[name,name.split('-')[0]]).reduce((map,[name,group])=>(map[group]=(map[group]||[]).concat(name),map),{});
	const grid=document.getElementById('grid');
	svgs.filter(([id])=>id.split('.')[0]).map(([id,...g])=>grid.append(el('img',{src:`data:image/svg+xml;utf8,`+toSVG(g,8),title:id.split('.')[0]})))
}
</script>



<h1>
OpenType Font
</h1>

<h2>Usage</h2>
<textarea class=picon style=font-size:32px>app ùçñ ‚ôø</textarea>

<p id=font class=picon></p>
<script>
function normalize(p,w=16,h=16){
	let [x,y] = p.match(/[0-9.]+/g)
	return [x*2, h-y*2]
}
function showFont(svgs, advanceWidth=16){
	const notdefGlyph = new opentype.Glyph({
		name: '.notdef', unicodes: 0,advanceWidth, path: new opentype.Path()});
	const alphaGlyphs = [];/*"-abcdefghijklmnopqrstuvwxyz0123456789".split('').map(name=>new opentype.Glyph({
		name, unicode: name.charCodeAt(0), advanceWidth, path: new opentype.Path()}));*/
	var ligatures = [];
	const glyphs = [notdefGlyph,...alphaGlyphs, ...svgs.map((svg,i) => {
		const [name,uni] = svg[0].split('.');
		const unicode = (!name&&uni&&uni.length==1)?uni.charCodeAt(0):0xE000+i;
		const path = svg.slice(1).reduce((path,p)=>((p[0]=='M'?path.moveTo(...normalize(p)):path.lineTo(...normalize(p)),path)),new opentype.Path());
		const glyph = new opentype.Glyph({name:name||uni, unicode, advanceWidth, path});
		if(name)ligatures.push({sub: name, by:glyph});
		return glyph;
	})]
	const fontMetrics = {unitsPerEm: advanceWidth, ascender: advanceWidth, descender: -Number.EPSILON};
	const font = new opentype.Font({familyName: 'Picon', styleName: 'Medium',...fontMetrics, glyphs});
	ligatures.forEach(({sub,by}) => font.substitution.add("liga",{
		sub:sub.split('').map(e=>e.charCodeAt(0)).map(unicode=>glyphs.findIndex(g=>g.unicode==unicode)),
		by:glyphs.indexOf(by)
	}) );
	document.fonts.add(new FontFace(font.names.fontFamily.en, font.toArrayBuffer()));
font.download()
}
</script>

